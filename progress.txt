# Codebase Quality Review Progress

## Current Phase: Phase 3 - Ruff Fixes Complete, Continuing Migration

## Utilities Created
- [x] agentwire/utils/__init__.py - Package init with re-exports
- [x] agentwire/utils/subprocess.py - run_command(), run_command_check()
- [x] agentwire/utils/file_io.py - load_json(), save_json(), load_yaml(), save_yaml()
- [x] agentwire/utils/paths.py - agentwire_dir(), config_path(), logs_dir(), etc.
- [ ] agentwire/utils/audio.py (if needed - defer until listen.py/voiceclone.py review)

## Files Migrated to Utilities
- [x] tunnels.py (382 lines) - subprocess → run_command, paths → agentwire_dir
- [x] history.py (394 lines) - subprocess → run_command, file_io → load_json
- [x] pane_manager.py (484 lines) - subprocess → run_command (all 20+ calls)
- [ ] __main__.py (5,762 lines) - subprocess, file_io (large - do last)
- [ ] server.py (3,050 lines) - subprocess, file_io
- [ ] onboarding.py (1,469 lines) - subprocess, file_io
- [ ] listen.py (393 lines) - subprocess, paths
- [ ] voiceclone.py (309 lines) - subprocess, paths

## Docstrings Added
- [x] tunnels.py - already had good docstrings, enhanced module docstring
- [x] history.py - already had good docstrings, enhanced module docstring
- [x] pane_manager.py - already had good docstrings, enhanced module docstring
- [ ] __main__.py
- [ ] server.py
- [ ] config.py (verify existing)
- [ ] agents/tmux.py

## Documentation
- [ ] CONTRIBUTING.md created
- [ ] Module docstrings added to all files

## Ruff Status
- Last run: All checks passed!
- Errors: 0
- Fixed: 19 errors fixed in iteration 3

## Iteration Log
### Iteration 1 (Phase 1 - Utilities)
- Created agentwire/utils/ package
- Added subprocess.py: CommandResult dataclass, run_command(), run_command_check()
- Added file_io.py: load_json(), save_json(), load_yaml(), save_yaml() with atomic writes
- Added paths.py: agentwire_dir(), config_path(), machines_path(), logs_dir(), voices_dir(), etc.
- Verified imports work with `uv run python`
- Committed: feat: add utility modules for subprocess, file I/O, paths

### Iteration 2 (Phase 2 - Migration)
- Migrated tunnels.py: 3 subprocess.run → run_command, Path.home() → agentwire_dir()
- Migrated history.py: 2 subprocess.run → run_command, json.load → load_json
- Migrated pane_manager.py: 20+ subprocess.run → run_command, removed unused import
- Committed: refactor: migrate tunnels, history, pane_manager to use utilities

### Iteration 3 (Ruff Fixes)
- Fixed F821 (undefined names):
  - onboarding.py:1162 - prompt_text → prompt (function was named prompt)
  - server.py:956 - machine → ssh_target (variable was defined as ssh_target)
- Fixed F841 (unused variables):
  - __main__.py:1072 - removed unused stt_config, then config
  - onboarding.py:1117 - removed req = before urlopen
  - server.py:909 - removed unused loop variable
  - server.py:2766 - removed result = before subprocess.run
  - validation.py:174 - removed unused machine_ids
- Fixed W293 (whitespace in blank lines):
  - cli_safety.py:86
  - hooks/damage-control/bash-tool-damage-control.py:47
- Fixed E402 (imports after code):
  - runpod_handler.py - added noqa: E402 comments (intentional for debug prints)
- Fixed N999 (invalid module names):
  - Added per-file-ignores in pyproject.toml for hooks directory
  - Hook files intentionally named with dashes to match Claude Code convention

## Issues Found
- onboarding.py had prompt_text (undefined) instead of prompt (defined)
- server.py had machine (undefined) instead of ssh_target (defined) - real bug in resize handling
