# AgentWire Full Stack - Docker Compose
# Portal with integrated STT + (optional) local TTS

services:
  # Portal - Web UI, session orchestrator, and STT (all in one)
  portal:
    build:
      context: .
      dockerfile: Dockerfile.portal
      args:
        # Whisper model for STT: tiny, base, small, medium, large-v2, large-v3
        WHISPER_MODEL: ${WHISPER_MODEL:-base}
    container_name: agentwire-portal
    ports:
      - "8765:8765"   # Portal web UI
      - "8100:8100"   # STT service
      - "2222:22"     # SSH access
    volumes:
      # Config directory (required)
      - ${HOME}/.agentwire:/root/.agentwire
      # SSH keys for remote machine access (optional)
      - ${HOME}/.ssh:/root/.ssh:ro
      # Projects directory for worktrees (optional)
      - ${HOME}/projects:/projects
    environment:
      # STT runs locally in the same container
      - AGENTWIRE_STT__BACKEND=remote
      - AGENTWIRE_STT__URL=http://localhost:8100
      # TTS backend (runpod recommended, or chatterbox for local GPU)
      - AGENTWIRE_TTS__BACKEND=${TTS_BACKEND:-runpod}
      - AGENTWIRE_TTS__URL=http://tts:8100  # Used if TTS_BACKEND=chatterbox
      # Whisper config
      - WHISPER_MODEL=${WHISPER_MODEL:-base}
      - WHISPER_DEVICE=cpu
    networks:
      - agentwire
    restart: unless-stopped

  # TTS - Text-to-speech service (optional, local Chatterbox)
  # Comment out if using RunPod for TTS
  # tts:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.runpod
  #     args:
  #       HF_TOKEN: ${HF_TOKEN}
  #     build-context:
  #       voices: ${HOME}/.agentwire/voices
  #   container_name: agentwire-tts
  #   deploy:
  #     resources:
  #       reservations:
  #         devices:
  #           - driver: nvidia
  #             count: 1
  #             capabilities: [gpu]
  #   networks:
  #     - agentwire
  #   restart: unless-stopped

networks:
  agentwire:
    driver: bridge
